import numpy as np
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

methods = [
    "Tanh-fast",
    "Proposed-fast",
    "Otsu-fast",
    "Sauvola",
    "Niblack",
    "Bernsen"
]

# ====================================================================
#  DATI COMPLETI estratti dal file BIN_LOG_3.txt
# ====================================================================

data_raw = {

100: {
3:  [0.00206524, 0.000331761, 2.23794e-05, 4.49032e-05, 5.56686e-05, 8.3114e-05],
7:  [5.47789e-05, 3.18859e-05, 2.5628e-05, 5.25457e-05, 6.00518e-05, 4.33045e-05],
11: [5.79994e-05, 3.14982e-05, 2.04835e-05, 8.80142e-05, 8.38802e-05, 0.000101962],
15: [5.35388e-05, 3.10518e-05, 2.0399e-05, 0.000160729, 0.00018947, 0.000192582],
19: [4.92414e-05, 3.26599e-05, 9.69537e-05, 0.000257547, 0.000244142, 0.00029414],
23: [5.27574e-05, 2.95575e-05, 3.85443e-05, 0.000350157, 0.000359353, 0.00041457],
27: [5.19951e-05, 2.98762e-05, 2.80649e-05, 0.00043234, 0.000481362, 0.000548325],
31: [5.97371e-05, 3.48722e-05, 1.9663e-05, 0.000552605, 0.000567561, 0.000633594],
35: [5.297e-05, 3.15981e-05, 8.99948e-05, 0.000705841, 0.000684738, 0.000866587]
},

250: {
3:  [0.000446903, 0.000231318, 9.60453e-05, 0.000124377, 0.00011008, 0.00010447],
7:  [0.000444075, 0.000244487, 7.48167e-05, 0.000275237, 0.000329969, 0.000256533],
11: [0.00038745, 0.000223915, 7.58139e-05, 0.00057676, 0.000552787, 0.000667939],
15: [0.000378908, 0.000231147, 9.43731e-05, 0.00105394, 0.00115923, 0.00117325],
19: [0.00041947, 0.000245213, 8.01767e-05, 0.0015083, 0.0015263, 0.00186603],
23: [0.000389582, 0.000239663, 8.04392e-05, 0.00223048, 0.00229022, 0.00254579],
27: [0.000395107, 0.000241626, 9.99946e-05, 0.00298866, 0.00323783, 0.00320983],
31: [0.000399552, 0.000229623, 7.83987e-05, 0.00386655, 0.00399559, 0.00393335],
35: [0.000401449, 0.000231367, 0.000122544, 0.00484597, 0.00476877, 0.00597439]
},

500: {
3:  [0.0016463, 0.000905838, 0.000364785, 0.000499944, 0.000449538, 0.000430946],
7:  [0.00152165, 0.000874465, 0.000301756, 0.0011749, 0.00105869, 0.00102311],
11: [0.00151417, 0.000939164, 0.000694525, 0.00231175, 0.00220842, 0.00245317],
15: [0.00152157, 0.000876115, 0.000389664, 0.00394674, 0.00380978, 0.00453548],
19: [0.00150405, 0.000865887, 0.000402325, 0.00613811, 0.0061062, 0.00731981],
23: [0.00153984, 0.000957379, 0.000323947, 0.00942791, 0.00904454, 0.00992458],
27: [0.00182683, 0.00148637, 0.00101721, 0.0136113, 0.0134105, 0.0134986],
31: [0.00295754, 0.00159741, 0.00219283, 0.0155713, 0.0163867, 0.0175902],
35: [0.0020175, 0.00148929, 0.000868076, 0.0205983, 0.0208242, 0.0236539]
},

1000: {
3:  [0.00880849, 0.0058364, 0.0019679, 0.00262961, 0.00219039, 0.00256834],
7:  [0.00790051, 0.00469363, 0.00182678, 0.00551117, 0.0049161, 0.00464263],
11: [0.0076053, 0.00438377, 0.00136781, 0.00981, 0.00928535, 0.0105112],
15: [0.0101633, 0.00658571, 0.00310234, 0.0181893, 0.0181702, 0.0204551],
19: [0.00878565, 0.00552983, 0.00238967, 0.0252351, 0.0242324, 0.0284329],
23: [0.0077717, 0.0050439, 0.00199653, 0.0377109, 0.0378875, 0.0403789],
27: [0.00699285, 0.00497245, 0.00234461, 0.0494788, 0.0498326, 0.0524927],
31: [0.00774329, 0.00542753, 0.00187143, 0.0619191, 0.0609703, 0.0623833],
35: [0.00740804, 0.00427206, 0.00136056, 0.0753419, 0.075252, 0.0915568]
},

1500: {
3:  [0.0176008, 0.0114956, 0.00326109, 0.0049511, 0.00466693, 0.00406426],
7:  [0.0163116, 0.0116545, 0.00326542, 0.0107718, 0.010214, 0.00929905],
11: [0.0168903, 0.011938, 0.00343954, 0.0219934, 0.0208465, 0.0220057],
15: [0.0169802, 0.0113713, 0.00415442, 0.0374331, 0.0362163, 0.0412137],
19: [0.0182667, 0.0118255, 0.00430176, 0.0548203, 0.054034, 0.0633493],
23: [0.0171217, 0.0134508, 0.00429396, 0.0774651, 0.0782143, 0.0892565],
27: [0.0166209, 0.0120833, 0.0037685, 0.101664, 0.102079, 0.113124],
31: [0.0166046, 0.0121828, 0.00434544, 0.131724, 0.132668, 0.140708],
35: [0.0183041, 0.0134572, 0.00453677, 0.166567, 0.168209, 0.210444]
},

2000: {
3:  [0.0306972, 0.021948, 0.00734437, 0.00911523, 0.0086941, 0.00802774],
7:  [0.0297823, 0.0209683, 0.00730529, 0.0194249, 0.0184051, 0.0170849],
11: [0.0307002, 0.0229602, 0.00937336, 0.0403988, 0.0384377, 0.040951],
15: [0.0300716, 0.0227172, 0.00939741, 0.0628425, 0.0634602, 0.0742281],
19: [0.0299466, 0.0229724, 0.00940367, 0.0932606, 0.0929305, 0.114649],
23: [0.0296569, 0.0222561, 0.0079459, 0.133077, 0.132851, 0.159037],
27: [0.0294538, 0.0225449, 0.00902618, 0.176283, 0.178582, 0.203381],
31: [0.0294423, 0.0224496, 0.00821089, 0.229361, 0.230608, 0.253234],
35: [0.0287222, 0.0227972, 0.00971618, 0.28679, 0.287387, 0.36448]
},

2500: {
3:  [0.0485141, 0.0340128, 0.0120385, 0.0150459, 0.0132963, 0.0125461],
7:  [0.0457831, 0.0332459, 0.0129036, 0.0305484, 0.0292248, 0.026642],
11: [0.0479589, 0.0333304, 0.0130206, 0.056921, 0.0566123, 0.062388],
15: [0.0464309, 0.0336088, 0.0121109, 0.0940017, 0.0943594, 0.113295],
19: [0.0453992, 0.0337541, 0.0138434, 0.139093, 0.139735, 0.176869],
23: [0.0467608, 0.0350284, 0.0145071, 0.21075, 0.209994, 0.254495],
27: [0.0464511, 0.0365712, 0.0146943, 0.279082, 0.277958, 0.328075],
31: [0.0438305, 0.0353066, 0.0121211, 0.350815, 0.351877, 0.392711],
35: [0.0466109, 0.0350048, 0.0165803, 0.47193, 0.473728, 0.598425]
},

3000: {
3:  [0.0678413, 0.0484406, 0.0178957, 0.0213871, 0.0190382, 0.0181022],
7:  [0.0692065, 0.0503836, 0.0200204, 0.0476101, 0.0447047, 0.0417168],
11: [0.0705433, 0.0542423, 0.0232806, 0.0858065, 0.0866907, 0.103099],
15: [0.0712642, 0.0524866, 0.0245981, 0.145214, 0.142935, 0.175738],
19: [0.0712834, 0.0531425, 0.0258301, 0.226509, 0.229023, 0.29245],
23: [0.0720601, 0.0555649, 0.0270523, 0.342108, 0.347502, 0.459666],
27: [0.073403, 0.0555807, 0.0278793, 0.463233, 0.456462, 0.580443],
31: [0.0658504, 0.0528217, 0.0238882, 0.547058, 0.552304, 0.62243],
35: [0.0649678, 0.0542592, 0.0225195, 0.690547, 0.698641, 0.892625]
},

3500: {
3:  [0.0931195, 0.0659131, 0.0242911, 0.0283153, 0.0271874, 0.0258201],
7:  [0.0904143, 0.0658095, 0.0249126, 0.0594334, 0.0571592, 0.052957],
11: [0.090785, 0.0666489, 0.0244416, 0.105993, 0.104791, 0.121963],
15: [0.0889765, 0.0671238, 0.025341, 0.176783, 0.174986, 0.219596],
19: [0.0878019, 0.066757, 0.024816, 0.268865, 0.270606, 0.346352],
23: [0.0885616, 0.0690433, 0.0259729, 0.39597, 0.397213, 0.486278],
27: [0.0875193, 0.0692524, 0.0262301, 0.53104, 0.538687, 0.619343],
31: [0.0884115, 0.070411, 0.0271654, 0.702866, 0.706936, 0.776806],
35: [0.0893656, 0.0691505, 0.024088, 0.867996, 0.873525, 1.11053]
},

4000: {
3:  [0.121047, 0.0865424, 0.0346615, 0.0379834, 0.0363039, 0.0343271],
7:  [0.117817, 0.0886168, 0.0335687, 0.0764892, 0.0738043, 0.0706692],
11: [0.113428, 0.0869509, 0.0329398, 0.135055, 0.134099, 0.158843],
15: [0.114573, 0.0885371, 0.033864, 0.230268, 0.227783, 0.286526],
19: [0.117314, 0.0869863, 0.0324649, 0.349754, 0.348724, 0.448941],
23: [0.118595, 0.0876436, 0.0339482, 0.518027, 0.513903, 0.635818],
27: [0.119635, 0.0880622, 0.0330988, 0.688945, 0.693055, 0.808346],
31: [0.122631, 0.0873406, 0.0323732, 0.891772, 0.889643, 1.00207],
35: [0.118945, 0.0909349, 0.0332236, 1.1183, 1.12166, 1.42683]
}

}

# ------------------------------------------------------------------
# Preparo vettori ordinati
# ------------------------------------------------------------------
crop_sizes = sorted(list(data_raw.keys()))
window_sizes = sorted(list(next(iter(data_raw.values())).keys()))

num_methods = len(methods)

colors = ['blue', 'green', 'red', 'orange', 'purple', 'cyan']

# ------------------------------------------------------------------
# Costruzione dei tensori: times[method, w, N]
# ------------------------------------------------------------------

times = np.zeros((num_methods, len(window_sizes), len(crop_sizes)))

for mi, method in enumerate(methods):
    for wi, w in enumerate(window_sizes):
        for ni, N in enumerate(crop_sizes):
            times[mi, wi, ni] = data_raw[N][w][mi]

# ------------------------------------------------------------------
# Meshgrid W,N → per surface plots
# ------------------------------------------------------------------
W, Ngrid = np.meshgrid(window_sizes, crop_sizes, indexing='ij')

# ------------------------------------------------------------------
# FIGURE CON 3 SUBPLOTS
# ------------------------------------------------------------------

fig = plt.figure(figsize=(16, 6))

# =============================================================
# 1) 3D SURFACE PLOT (equivalente al secondo blocco)
# =============================================================
ax = fig.add_subplot(1, 2, 1, projection='3d')

for mi, method in enumerate(methods):
    T = times[mi, :, :]
    ax.plot_surface(W, Ngrid, T, color=colors[mi % len(colors)], alpha=0.6)

ax.set_xlabel("Window size w")
ax.set_ylabel("Crop size N")
ax.set_zlabel("Runtime (s)")
ax.set_title("Runtime surface per method")

# legenda “fittizia”
for mi, method in enumerate(methods):
    ax.plot([], [], color=colors[mi % len(colors)], label=method)
ax.legend()


# =============================================================
# 2) Slice: average runtime vs w
# =============================================================
ax2 = fig.add_subplot(2, 2, 2)

for mi, method in enumerate(methods):
    T = times[mi, :, :]
    ax2.plot(window_sizes, T.mean(axis=1),
             marker='o',
             color=colors[mi % len(colors)],
             label=method)

ax2.set_xlabel('w')
ax2.set_ylabel('Runtime (s)')
ax2.set_title('Average t vs w')
ax2.legend()


# =============================================================
# 3) Slice: average runtime vs N
# =============================================================
ax3 = fig.add_subplot(2, 2, 4)

for mi, method in enumerate(methods):
    T = times[mi, :, :]
    ax3.plot(crop_sizes, T.mean(axis=0),
             marker='o',
             color=colors[mi % len(colors)],
             label=method)

ax3.set_xlabel('N')
ax3.set_ylabel('Runtime (s)')
ax3.set_title('Average t vs N')
ax3.legend()

plt.tight_layout()
plt.show()